{% extends 'base.html' %}
{% block title %}Transactions - Admin{% endblock %}
{% block content %}
<div class="animate-slide-in">
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Toutes les transactions</h1>
            <p class="text-gray-600 mt-1">Gestion globale des opérations</p>
        </div>
        <a href="{% url 'admin_dashboard' %}" class="text-blue-600 hover:text-blue-700">
            <i class="fas fa-arrow-left mr-2"></i>Retour
        </a>
    </div>
    
    <!-- Filtres -->
    <div class="card p-6 mb-6">
        <form method="get" class="flex flex-wrap gap-4">
            <select name="type" onchange="this.form.submit()" class="px-4 py-2 border rounded-lg">
                <option value="">Tous les types</option>
                <option value="DEPOSIT">Dépôts</option>
                <option value="WITHDRAWAL">Retraits</option>
                <option value="TRANSFER">Transferts</option>
            </select>
            <select name="status" onchange="this.form.submit()" class="px-4 py-2 border rounded-lg">
                <option value="">Tous les statuts</option>
                <option value="SUCCESS">Réussies</option>
                <option value="PENDING">En attente</option>
                <option value="FAILED">Échouées</option>
            </select>
        </form>
    </div>
    
    <!-- Tableau -->
    {% if transactions %}
    <div class="card overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Type</th>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Utilisateur</th>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Montant</th>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Frais</th>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Statut</th>
                        <th class="text-left py-4 px-6 text-sm font-semibold text-gray-700">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in transactions %}
                    <tr class="border-t hover:bg-gray-50">
                        <td class="py-4 px-6">
                            <span class="badge {% if txn.type == 'DEPOSIT' %}bg-green-100 text-green-800
                                {% elif txn.type == 'WITHDRAWAL' %}bg-red-100 text-red-800
                                {% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ txn.get_type_display }}
                            </span>
                        </td>
                        <td class="py-4 px-6 text-sm">
                            {% if txn.sender_account.user %}
                            <a href="{% url 'admin_user_detail' user_id=txn.sender_account.user.id %}" 
                               class="text-blue-600 hover:text-blue-700">
                                {{ txn.sender_account.user.email }}
                            </a>
                            {% else %}Plateforme{% endif %}
                        </td>
                        <td class="py-4 px-6 font-semibold">{{ txn.amount|floatformat:0 }} FCFA</td>
                        <td class="py-4 px-6 text-sm text-gray-600">{{ txn.fee|floatformat:0 }}</td>
                        <td class="py-4 px-6">
                            <span class="badge {% if txn.status == 'SUCCESS' %}bg-green-100 text-green-800
                                {% elif txn.status == 'PENDING' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-red-100 text-red-800{% endif %}">
                                {{ txn.get_status_display }}
                            </span>
                        </td>
                        <td class="py-4 px-6 text-sm text-gray-600">{{ txn.created_at|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="card p-12 text-center">
        <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Aucune transaction</h3>
    </div>
    {% endif %}
</div>
{% endblock %}